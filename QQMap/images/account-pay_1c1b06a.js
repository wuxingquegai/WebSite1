clouda.define("mbaas/account",function(o){var e=clouda.lightapp,i=clouda.mbaas.account={},o=clouda.mbaas||{},n=clouda.DelegateClass,t=clouda.kuangForReady,l=(clouda.runtimeError,clouda.installPlugin,clouda.cloudaBLight,new n("device","login","login"),null);o.LOGIN_TYPE={WEIBO:"sinaweibo",QQ:"qqdenglu",KAIXIN:"kaixin",QQWEIBO:"qqweibo",RENREN:"renren"};var a=!1,r=function(o){var e={client_id:clouda.lightapp.ak,redirect_uri:o.redirect_uri,scope:o.scope||"basic",login_mode:o.login_mode||0,login_type:o.login_type||void 0,mobile:o.mobile||void 0,display:"mobile",response_type:"code",state:o.state||void 0};return 1===e.login_mode&&(e.confirm_login=1),2===e.login_mode&&(e.force_login=1),e.disable_third_login=0===o.disable_third_login?o.disable_third_login:1,o.authorize_url&&(e.authorize_url=o.authorize_url),e},c=function(o){var e="https://openapi.baidu.com/oauth/2.0/authorize";o.authorize_url&&(e=o.authorize_url);var i=e+"?response_type=code&client_id="+clouda.lightapp.ak+"&redirect_uri="+encodeURIComponent(o.redirect_uri);return o.login_mode&&(i+="&login_mode="+o.login_mode),o.login_type&&(i+="&login_type="+o.login_type),o.client_id&&(i+="&client_id="+o.client_id),o.scope&&(i+="&scope="+o.scope),o.state&&(i+="&state="+o.state),o.display&&(i+="&display="+o.display),o.force_login&&(i+="&force_login="+o.force_login),o.confirm_login&&(i+="&confirm_login="+o.confirm_login),o.mobile&&(i+="&mobile="+o.mobile),o.return_callback&&(i+="&return_callback="+encodeURIComponent(location.origin)),i+="&disable_third_login="+o.disable_third_login};i.login=function(o){if(!o.redirect_uri)return console.error("missing redirect_uri"),!1;var e=r(o);if(!o.onsuccess||!o.onfail){var i=c(e);return void(location.href=i)}if(!Boolean(o.force_h5)&&clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.login){var n=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);BLightApp.login(JSON.stringify(e),n.s,n.f)}else{e.return_callback=1;var i=c(e);document.querySelector("#cloudaLoginFrame")?l=document.querySelector("#cloudaLoginFrame"):(l=document.createElement("iframe"),l.id="cloudaLoginFrame"),l.src=i,l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.scrolling="no",l.style.border="none",l.style.backgroundColor="#fff",l.style.display="none",l.style.zIndex="99999",document.body.appendChild(l),a||window.addEventListener("message",function(e){var i=e.data;"return_callback"===i&&(clouda.mbaas.account.closeLoginDialog(),o.onfail()),"show_login"===i&&(l.style.display="block"),a=!0},!1);var t=top.innerWidth>=top.document.body.offsetHeight?top.innerWidth:top.document.body.offsetHeight;l.style.width=top.innerWidth+"px",l.style.height=t+"px",l.onload=function(){l.style.width=top.innerWidth+"px",l.style.height=t+"px"}}},i.closeLoginDialog=function(){l&&document.body.contains(l)&&document.body.removeChild(l)},i.bdLogin=function(o){if(!clouda.STATUS.SUCCESS)return void t("clouda.mbaas.account.bdLogin",arguments);if(!o.onsuccess||!o.onfail||"function"!=typeof o.onsuccess||"function"!=typeof o.onfail||!o.tpl)return e.error(ErrCode.UNKNOW_INPUT,ErrCode.UNKNOW_INPUT,o),!1;var i={};if(i.u=o.u?encodeURIComponent(o.u):"",i.uid=o.uid||"",i.regtype=o.regtype||"",i.from=o.from||"",i.bd_page_type=o.bd_page_type||"",i.pu=o.pu||"",i.tn=o.tn||"",i.tpl=o.tpl,i.login_type=o.login_type||"",i.mobile=o.mobile||"",clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.bdLogin){var n=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);return void BLightApp.bdLogin(JSON.stringify(i),n.s,n.f)}var l="http://wappass.baidu.com/passport/",a=l+"?login&u="+i.u+"&uid="+i.uid+"&pu="+i.pu+"&regtype="+i.regtype+"&from="+i.from+"&bd_page_type="+i.bd_page_type+"&tn="+i.tn+"&tpl="+i.tpl;if(o.extra_params){var r=o.extra_params;for(var c in r)r.hasOwnProperty(c)&&(a=a+"&"+c+"="+r[c])}return void(1==o.noReplace?location.href=a:location.replace(a))},i.checkSupport=function(o){var e={};clouda.RUNTIME===clouda.RUNTIMES.NUWA?e["native"]=0:clouda.RUNTIME===clouda.RUNTIMES.KUANG?e["native"]=BLightApp&&"function"==typeof BLightApp.login?1:0:clouda.RUNTIME===clouda.RUNTIMES.WEB&&(e["native"]=0),e.web=1,o(e)}});
;clouda.define("mbaas/pay",function(){var a=clouda.lightapp,o=clouda.mbaas.pay={},i=(clouda.mbaas||{},clouda.DelegateClass),d=clouda.kuangForReady,r=(clouda.runtimeError,clouda.installPlugin,clouda.cloudaBLight,new i("lightpay","init"),new i("lightpay","dopay"),["lecai.com","cloudaapi.duapp.com"]);o.init=function(o,i){if(!o)return a.error(ErrCode.UNKNOW_INPUT,ErrCode.UNKNOW_INPUT,i),!1;if("number"==typeof o&&(o=String(o)),!clouda.STATUS.SUCCESS)return void d("clouda.mbaas.pay.init",arguments);if(clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.initpay){var r=clouda.lib.utils.regcallback(function(){i.onsuccess(clouda.STATUS.SUCCESS)},i.onfail);return BLightApp.initpay(r.s,r.f,o),!1}clouda.RUNTIME===clouda.RUNTIMES.NUWA},o.doPay=function(o){if(o.hideLoading||(o.hideLoading=!1),o.orderInfo||a.error(ErrCode.PAY_ERROR,ErrCode.UNKNOW_INPUT,o),!clouda.STATUS.SUCCESS)return void d("clouda.mbaas.pay.doPay",arguments);if(clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.dopay){var i=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);if(clouda.PLATFORM===clouda.PLATFORMS.IOS){for(var u=o.safari?!0:!1,n=0,t=r.length;t>n;n++)if(-1!==location.origin.indexOf(r[n])){u=!0;break}if(u){if(clouda.RUNTIME_VERSION>"5.3.5"){var c={ExternalURL:"http://baifubao.baidu.com/jump?uri=/api/0/pay/0/wapdirect/0&"+o.orderInfo};BLightApp.dopay(i.s,i.f,o.orderInfo,o.hideLoading,JSON.stringify(c))}else BLightApp.dopay(i.s,i.f,o.orderInfo,o.hideLoading);return}}return BLightApp.dopay(i.s,i.f,o.orderInfo,o.hideLoading),!1}return 1==o.noLogin?(location.href="http://baifubao.baidu.com/jump?uri=/api/0/pay/0/wapdirect&"+o.orderInfo,!1):(location.href="http://baifubao.baidu.com/jump?uri=/api/0/pay/0/wap/0/cashdesk/0&"+o.orderInfo,!1)},o.checkSupport=function(a){var o={};clouda.RUNTIME===clouda.RUNTIMES.NUWA?o["native"]=1:clouda.RUNTIME===clouda.RUNTIMES.KUANG?o["native"]=BLightApp&&"function"==typeof BLightApp.dopay?1:0:clouda.RUNTIME===clouda.RUNTIMES.WEB&&(o["native"]=0),o.web=1,a(o)}});