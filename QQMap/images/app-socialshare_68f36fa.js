clouda.define("mbaas/app",function(){function o(){return clouda.RUNTIME===clouda.RUNTIMES.KUANG&&clouda.PLATFORM===clouda.PLATFORMS.IOS&&"function"==typeof BLightApp.addLAPush?!0:!1}function c(o,c,u){var a={appid:u.appid,statis_ext:{src:"clouda"},push_action:c};u.nonce&&(a.nonce=u.nonce),u.csrftoken&&(a.csrftoken=u.csrftoken),u.tag&&(a.tags=[u.tag]);var n={push_params:a},i=function(){u.onsuccess(1)},e=function(o){u.onfail(o)};return t(o,JSON.stringify(n),i,e),!1}var u=clouda.lightapp,a=clouda.mbaas.app={},n=(clouda.mbaas||{},clouda.DelegateClass,clouda.kuangForReady,clouda.runtimeError,clouda.installPlugin),t=clouda.cloudaBLight;a.followSite=function(a,i){return a?(clouda.lib.utils.setLogStorage("app","followSite"),o()?(i.appid=a,void c("addLAPush","subscribe",i)):clouda.RUNTIME===clouda.RUNTIMES.KUANG?clouda.RUNTIME_VERSION<5.3?(i.onsuccess&&"function"==typeof i.onsuccess&&i.onsuccess(0),void clouda.lib.moplus.openApp(!1,a,{tip:"请使用最新版【手机百度】\n订阅",startDownload:1})):(t("followSite",function(){i.onsuccess(clouda.STATUS.SUCCESS)},i.onfail),!1):"undefined"!=typeof BLightApp||navigator.userAgent.match(/baiduboxapp\/([\d.-_]*)/i)?clouda.RUNTIME_VERSION>=5.3?void clouda.lib.moplus.openApp(!0,a):(i.onsuccess&&"function"==typeof i.onsuccess&&i.onsuccess(0),void clouda.lib.moplus.openApp(!1,a,{tip:"请使用最新版【手机百度】\n订阅",startDownload:1})):void(clouda.RUNTIME===clouda.RUNTIMES.NUWA&&n("device",function(){nuwa.am.subscribe(a,function(){i.onsuccess(clouda.STATUS.SUCCESS)},function(o){u.error(ErrCode.APP_ERROR,o,i)})}))):void 0},a.checkFollow=function(o,c){return o?(clouda.lib.utils.setLogStorage("app","checkFollow"),clouda.RUNTIME===clouda.RUNTIMES.KUANG?(t("queryWzStatus",function(o){c.onsuccess(parseInt(o.status,10))},c.onfail),!1):void n("device",function(){nuwa.am.hasSubscribed(o,function(o){c.onsuccess(o?1:0)},function(o){u.error(ErrCode.APP_ERROR,o,c)})})):void u.error(ErrCode.UNKNOW_INPUT,ErrCode.UNKNOW_INPUT,c)},a.checkSupport=function(o){var c={};clouda.RUNTIME===clouda.RUNTIMES.NUWA?c["native"]=1:clouda.RUNTIME===clouda.RUNTIMES.KUANG?c["native"]=BLightApp&&"function"==typeof BLightApp.followSite?1:0:clouda.RUNTIME===clouda.RUNTIMES.WEB&&(c["native"]=0),c.web=0,o(c)}});
;clouda.define("mbaas/socialshare",function(){function e(e){var i=clouda.lightInit.ak||clouda.lightapp.ak,t=document.getElementsByClassName("bdSharePopup");if(1==e.hide){for(var c,d=0,u=t.length;u>d;d++)c=t[d],"block"==c.style.display&&(c.style.display="none");return!1}var s=function(e){var n=e.parentNode;n&&n.removeChild(e)};if(!e.content)return!1;for(var p=t.length,h=p-1;h>=0;h--)t[h]&&s(t[h]);e.linkUrl=e.linkUrl?e.linkUrl:location.href,e.linkUrl=a(e.linkUrl),console.log(e.linkUrl),e.linkUrl=encodeURIComponent(e.linkUrl),e.imageUrl=e.imageUrl?encodeURIComponent(e.imageUrl):"";var m={afterRender:function(){console.log("afterRender exec...")},client_id:i,dom_id:"hidden_btn",content:e.content,theme:"native",appid:e.appid?e.appid:"",animate:!1,url:e.linkUrl,pic_url:e.imageUrl};if(console.log(m),document.querySelector("#hidden_btn"))return o=document.getElementById("hidden_btn"),void socShare.init(m,function(){o.dispatchEvent(r)});var f;f="http:"===window.location.protocol?"http://apps.bdimg.com":"https://openapi.baidu.com";var U=1.5;n(f+"/cloudaapi/socialshare-api/share.min.js?a="+U,function(){var n=["weixin_friend","weixin_timeline","qqfriend","sinaweibo","qqweibo","qqdenglu","renren","sms","email"];if(e.mediaType&&"all"!==e.mediaType){for(var a=!1,t=0,c=n.length;c>t;t++)if(n[t]==e.mediaType){a=!0;break}if(a)return void("weixin_friend"==e.mediaType||"weixin_timeline"==e.mediaType||"qqfriend"==e.mediaType?clouda.lib.moplus.openApp(!0,m.appid):"sinaweibo"==e.mediaType||"qqweibo"==e.mediaType||"renren"==e.mediaType?location.href="http://openapi.baidu.com/social/widget/share?method=share&media_type="+e.mediaType+"&client_id="+i+"&url="+e.linkUrl+"&pic_url="+e.imageUrl+"&content="+encodeURIComponent(e.content)+"&u="+e.linkUrl:"qqdenglu"==e.mediaType?location.href=socShare.acc.getQQHref(m):("sms"==e.mediaType||"email"==e.mediaType)&&socShare.acc.getShortLink({client_id:i,url:e.linkUrl},function(){var n=socShare.acc.shortLinks[e.mediaType];location.href="sms"==e.mediaType?socShare.acc.getSMSHref(e.content,n):socShare.acc.getEmailHref(e.content,n)}))}l=!0,document.querySelector("#hidden_btn")?console.log("js 加载失败"):(o=document.createElement("div"),o.id="hidden_btn",o.style.display="none",document.body.appendChild(o),socShare.init(m,function(){o.dispatchEvent(r)}))})}function n(e,n){var a,i,t,o=document.head||document.getElementsByTagName("head")[0]||document.documentElement;"object"==typeof e&&(i=e,e=void 0),t=i||{},e=e||t.url,n=n||t.success,a=document.createElement("script"),a.id="share_script",a.async=t.async||!1,a.type="text/javascript",a.charset=t.charset?t.charset:"utf-8",a.src=e,o.insertBefore(a,o.firstChild),"function"==typeof n&&(document.addEventListener?a.addEventListener("load",n,!1):a.onreadystatechange=function(){/loaded|complete/.test(a.readyState)&&(a.onreadystatechange=null,n())})}function a(e){var n=e,a=e.match(/^(http:\/\/|https:\/\/)?(.+\?)/i);if(a){for(var i=e.substring(a[0].length),t=i.split("&"),o=[],r=0;r<t.length;r++)t[r].match(/^bd_/)||o.push(t[r]);n=a[0]+o.join("&")}return n}{var i=(clouda.mbaas||{},clouda.lightapp),t=clouda.mbaas.socialshare={};clouda.DelegateClass,clouda.kuangForReady,clouda.runtimeError,clouda.installPlugin,clouda.cloudaBLight}t.loadFlag=1;var o=null,r=document.createEvent("HTMLEvents");r.initEvent("click",!1,!0),r.eventType="message";var l=!1;return t.callShare=function(n){if(clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.callShare||navigator.userAgent.match(/baiduboxapp\/([\d+.]+)/)&&clouda.RUNTIME_VERSION>="5.3.5"){if(1==n.hide)return!1;if(!n.onsuccess||!n.onfail||"function"!=typeof n.onsuccess||"function"!=typeof n.onfail)return i.error(ErrCode.UNKNOW_INPUT,ErrCode.UNKNOW_INPUT,n),!1;if(!n.content)return i.error(ErrCode.UNKNOW_INPUT,ErrCode.UNKNOW_INPUT,n),!1;if(!n.mediaType)return i.error(ErrCode.UNKNOW_INPUT,ErrCode.UNKNOW_INPUT,n),!1;n.title||(n.title="来自手机百度"),n.linkUrl||(n.linkUrl=location.href),n.linkUrl=a(n.linkUrl);var t=clouda.lib.utils.regcallback(n.onsuccess,n.onfail);if(clouda.RUNTIME===clouda.RUNTIMES.KUANG)BLightApp.callShare(JSON.stringify(n),t.s,t.f);else if("undefined"!=typeof Bdbox_android_utils&&"undefined"!=typeof Bdbox_android_utils.callShare)Bdbox_android_utils.callShare(JSON.stringify(n),t.s,t.f);else if(clouda.PLATFORM===clouda.PLATFORMS.IOS){var o="baiduboxapp://callShare?options="+encodeURIComponent(JSON.stringify(n))+"&errorcallback="+t.f+"&successcallback="+t.s;location.href=o}return!1}return clouda.RUNTIME===clouda.RUNTIMES.NUWA?(e(n),!1):(e(n),!1)},t.checkSupport=function(e){var n={};clouda.RUNTIME===clouda.RUNTIMES.NUWA?n["native"]=0:clouda.RUNTIME===clouda.RUNTIMES.KUANG?n["native"]=BLightApp&&"function"==typeof BLightApp.callShare?1:0:clouda.RUNTIME===clouda.RUNTIMES.WEB&&(n["native"]=navigator.userAgent.match(/baiduboxapp\/([\d+.]+)/)&&clouda.RUNTIME_VERSION>="5.3.5"?1:0),n.web=1,e(n)},t});